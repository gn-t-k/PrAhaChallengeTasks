# 【回答】サードパーティクッキーについて理解する

## 課題1

### ファーストパーティクッキーとサードパーティークッキーの違い

- ファーストパーティクッキー … ユーザーが訪問したWebサイトのドメインと同じドメインが発行したCookie
- サードパーティクッキー … ユーザーが訪問したWebサイトのドメインとは異なるドメインが発行したCookie

### サードパーティクッキーを利用してユーザー訪問履歴を把握できる仕組み

サードパーティのドメインにリクエストを送信してきたクライアントに、クライアントを一意に識別できるCookieを送信する。次回以降同じクライアントがサードパーティのドメインにリクエストを送信してきた場合、前回設定したCookieを参照すれば同一のクライアントであることがわかるため、ユーザーの訪問履歴を把握することができる。

### サードパーティクッキーが生成される流れ

#### 画像埋め込み

1. サードパーティのドメインで、何かしらリクエストを受けた場合`Set-Cookie`するようにサーバーを設定する
2. サードパーティのドメインで画像ファイルを配信する
3. サードパーティのドメインで配信されている画像をファーストパーティのドメインのWebサイトに埋め込む
4. ファーストパーティのWebサイトを訪れたユーザーは、画像を表示するためにサードパーティにリクエストを送信する
5. サードパーティから`Set-Cookie`属性が設定されたレスポンスが返ってくる

#### スクリプト埋め込み

1. サードパーティのドメインに、アクセス解析などを行うサーバーを用意する
2. サードパーティのドメインに、スクリプトを読み込んだクライアント側でcookieを作成→アクセス解析サーバーにデータを送信するスクリプトを用意する（`tag.js`とする）
3. ファーストパーティのWebサイトに`<script type="text/javascript" src="//third-party-domain.com/tag.js"></script>`のようなタグを埋め込む
4. ファーストパーティのWebサイトを訪れたユーザーのブラウザにはサードパーティクッキーが作成される

### ドメインが同一でポートが異なるクッキーはファーストパーティクッキーかどうか

ドメインが同一であれば、定義としてはファーストパーティクッキーである。ただし、ドメインが同一であってもポートが異なる場合は別のオリジンになるため、`SameSite`や`Secure`などの属性を適切に設定しないとクッキーは送信されない。

## 課題2

実装済み