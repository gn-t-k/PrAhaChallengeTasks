# WEBサービスの代表的な脆弱性を理解する

## 課題1

### XSS

ユーザーからの入力をもとに他のユーザーに提供するWebページを出力するソフトウェアに、悪意あるスクリプトを入力する攻撃手法。

#### XSSの仕組み

XSSの脆弱性は、以下のような手順で発生する。

1. 攻撃者によって、フォームなどからデータが入力される
2. Webアプリケーションが、入力されたデータをもとにWebページを動的に生成する
3. 入力されたデータには悪意あるスクリプトが含まれているが、Webアプリケーションはこれを排除しない
4. 一般ユーザーが、生成されたページにアクセスする
5. 攻撃車によって仕組まれた悪意あるスクリプトが、一般ユーザーのブラウザで実行される

#### XSSの発生し得る被害

- 正規のページに見せかけた不正なページにユーザーを誘導し、意図しない商品の購入等を行わせる
- 偽のログインページにユーザーを誘導し、IDやパスワードを抜き取る
- 偽の情報入力ページにユーザーを誘導し、個人情報やクレジットカード等の重要な情報を抜き取る
- Cookieを勝手に設定して、セッションを乗っとる
- Cookieを盗み、セッションを乗っ取る

#### XSSの対処法

ユーザーの入力をもとに動的にWebページを出力する場合、スクリプトなどは無効化するようにする。

### コマンドインジェクション

Webアプリケーションのプログラム内に、shellなどのコマンドを文字列で組み立てて実行している実装がある場合、そこにデータに紛れさせたコマンド文字列を外部から送り込み、コンピュータを不正に操作する攻撃手法。

#### コマンドインジェクションの仕組み

1. 攻撃者によって、フォームなどからデータが入力される
2. Webアプリケーション内で入力値とともにコマンドの文字列が組み立てられる
3. コマンドの文字列がWebサーバーのshellにおいて解釈・実行される
4. 攻撃者の悪意によって、想定していないコマンドが実行される

#### コマンドインジェクションの発生し得る被害

- Webサーバー内に保管してある情報が漏洩する
- Webアプリケーション内の情報が改ざんされる
- Webサーバーを破壊される

#### コマンドインジェクションの対処法

shellなどのコマンドを文字列で組み立てて実行するような処理を実装しない。どうしても必要な場合は、`;`や`&&`などの文字を無効化するようにする。

### SQLインジェクション

Webアプリケーションのプログラム内に、SQL文にパラメータを埋め込んで文字列で組み立てて実行している実装がある場合、そこにパラメータに紛れさせた特殊記号を外部から送り込み、データベースを不正に操作する攻撃手法。

#### SQLインジェクションの仕組み

次のようなSQL文を使用したログイン判定プログラムを例とする。

```sql
SELECT uid FROM account_table WHERE uid='ユーザID' AND pw='パスワード'
```

ユーザーID`uid`とパスワード`pw`を入力パラメータとして受け取り、その組み合わせが有効だった場合、ユーザーアカウントのテーブル`account_table`からユーザーIDを取得する処理である。

ここで、ユーザーIDに`' OR 1=1--`を入力した場合、次のようなSQL文が組み立てられる。

```sql
SELECT uid FROM account_table WHERE uid='' OR 1=1--' AND pw='パスワード'
```

`'`で文字列定数が終了し、`OR 1=1`で検索結果が必ず真になり、`--`でそれ以降のSQL文がコメントとして無視される。この文字列パラメータを与えられた場合、ユーザーIDとパスワードの組み合わせ判定が常に真として返ってくるため、本来ログインを許可されていないユーザーIDでもログインが可能になってしまう。

#### SQLインジェクションの発生し得る被害

SQLを記述することで実現できる操作が全て可能になってしまう。

- 情報の流出
- 情報の改ざん
- データベースの破壊

#### SQLインジェクションの対処法

- 入力値をチェックして、SQLインジェクションが発生し得る文字列を無視するよう処理する
- フレームワークで用意されたクエリを利用して、SQLを直接書かない

### CSRF

ユーザーに罠のリンクを踏ませることでユーザーのブラウザにCookieなどを利用して攻撃手段を仕込み、ユーザーが利用している別のWebサービスに、ユーザーが意図しないリクエストを送らせる攻撃手法。

#### CSRFの仕組み

1. 攻撃者は、ユーザーに踏ませるための罠のWebサーバーを用意する
2. ユーザーがなんらかの理由で罠のリンクを踏む
3. ユーザーのブラウザに、偽のセッションIDなどの攻撃手段が仕込まれる
4. ユーザーが、攻撃者が想定していた攻撃対象のWebサービスにリクエストを送信する
5. ユーザーからのリクエストをWebサービスが受け入れ、攻撃が成立する

#### CSRFの発生し得る被害

- 情報の流出
- なりすまし・アカウントの乗っ取り

#### CSRFの対処法

Webサーバーは、照合情報の埋め込みをするなどして、受け取ったリクエストが本当にユーザーが意図して送信したリクエストかどうかを検証する

## 課題2

## 課題3
