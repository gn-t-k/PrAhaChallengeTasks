# インデックスを理解する

データベースの分野における「インデックス」について調査した。

## インデックスとは

インデックスとは、データベースの表への処理を高速化するためのデータ構造のこと。表の中の1つ以上の列を対象に索引（インデックス）を作成することで、レコードへのアクセス効率を高めることができる。

### インデックスの使い方

以下のようなクエリでインデックスを作成することができる。

```sql
CREATE INDEX インデックスの名前 ON テーブルの名前(カラムの名前)
```

以下のようなクエリでインデックスを削除することができる。

```sql
DROP INDEX インデックスの名前 ON テーブルの名前(カラムの名前)
```

### インデックスの仕組み

インデックスは、検索するレコードを識別するデータの項目とその項目へのポインタで構成されている。B-Treeなどの検索しやすいデータ構造でインデックスを作成することによって、データを高速に検索することができる。

## インデックスを利用する際の注意点

データによって、インデックスを作成すべきものとそうでないものがある。カーディナリティや選択率といった概念でインデックスを利用すべきか否かを判断することができる。

### カーディナリティ

カーディナリティは、値のばらつき具合を表す指標のこと。例えば値が0か1の2種類しか入らないカラムであればカーディナリティは2で低く、顧客番号を扱うようなカラムであれば入る可能性がある値はテーブルのレコード数よりも多く、カーディナリティは高い。

### 選択率

選択率は、`絞り込んだ件数 / 総データ件数`で計算できる。

**インデックスは、選択率が低い列に作成するべき**である。選択率が高いカラムにインデックスを作成しても、インデックスによって絞り込めるデータの数が少ないため、インデックスを利用してもあまり高い効果が得られないため。

### slow query log

データベース管理システムによっては、SQLの実行時間を計測してログとして結果を出力してくれる機能がある。例えばMySQLのslow query logなどがあり、SQLの実行時間が指定した時間よりも長くなってしまっているSQLを出力することができる。適切でないカラムにインデックスを設定してしまった場合など、パフォーマンスの悪いSQLを特定する際に役に立つ。

## インデックスオンリースキャン

データベースからデータを読み取る際に、テーブルからデータを直接取得せず、インデックスのみを利用してデータを読み取る手法のこと。インデックスが作成されているカラムのデータだけ取得したい場合（他のカラムのデータは必要ない場合）に、テーブルのデータを取得せずにインデックスから高速にデータを取得することができる。インデックスオンリースキャンを実現するためにキーではない列に作成するインデックスのことをカバリングインデックスと呼ぶ。
