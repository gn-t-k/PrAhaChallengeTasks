# 冗長化されたWebアプリケーションを作ってみよう

## 課題1

### EC2インスタンスの作成

- 異なるAZが指定された2つのプライベートサブネットに、それぞれ1つずつEC2インスタンスを建てる
- このインスタンスはWebサーバーを動作させる予定なので、sshだけではなくhttp/httpsからのアクセスも受け付けるようにする必要がある
  - インバウンドルールにポート番号`80`（http）と`443`（https）、ソース`0.0.0.0/0`（IPv4）と`::/0`（IPv6）を許可する設定を追加する

### EC2インスタンスにNginxをインストール

- プライベートサブネットの2つのEC2インスタンスにNginxをインストールする
- プライベートサブネットのため、そのままではインターネットからNginxをダウンロードできないため、NATゲートウェイを設定する
  - パブリックサブネットにNATゲートウェイを作成する
  - プライベートサブネットのルートテーブルにルートを追加し、送信先`0.0.0.0/0`、ターゲットを作成したNATゲートウェイに指定する
- AMI`Amazon linux 2`でインスタンスを作成した場合、ソフトウェアパッケージのインストールは`amazon-linux-extras`を利用する必要がある

### Nginxの設定

- `/etc/nginx/nginx.conf`の`server`>`root`を編集し、配信するhtmlが格納してあるディレクトリを設定する
  - 初期設定では`/usr/share/nginx/html`になっている
- ディレクトリの設定とhtmlの配置が済んだら`sudo systemctl start nginx`でwebサーバーを起動する

### ALBの作成

- EC2 > ロードバランサーの作成 > ALBを選択
- VPCと、2つ以上のAZを選択する
  - 異なるAZが設定された2つ以上のサブネット（インターネットゲートウェイ設定済）が必要
- 外部からのリクエストを受け付けるセキュリティグループを選択する
- ルーティングを設定する
  - どこからのリクエストか？はプロトコルとポートで指定
  - どこへルーティングするか？はターゲットグループで指定
    - ターゲットグループは、ターゲットタイプ（インスタンスかIPアドレスか、など）やどのインスタンスをターゲットにするか？などを設定したもの
