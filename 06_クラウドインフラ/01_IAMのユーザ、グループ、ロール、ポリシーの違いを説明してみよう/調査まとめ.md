# IAMについて

## IAMとは

AWS IAMは、AWSユーザーがAWSのリソースにアクセスできる範囲やアクセスする方法を制御するためのサービス。

IAMユーザー、IAMグループ、IAMポリシー、IAMロールなどのエンティティを作成して制御を行う。

### IAMユーザー

IAMユーザーは、AWSとやりとりをするためのユーザーまたはアプリケーションを表すエンティティ。IAMユーザーは、「ユーザー名」と「認証情報」で構成される。ユーザー名はマネジメントコンソールに表示される名前のことで、認証情報はIAMユーザーのパスワードやアクセスキーなどのこと。

### IAMグループ

IAMグループは、IAMユーザーをまとめてグループ化して管理するためのエンティティ。IAMグループを利用することで、複数のユーザーに効率よくアクセス許可を設定することができる。

- IAMグループには複数のユーザーを設定することができる
- IAMユーザーは複数のIAMグループに所属することができる
- IAMグループにはIAMユーザーのみを含めることができる（IAMグループを含めてネストするようなことはできない）

### IAMポリシー

IAMポリシーは、IAMユーザー/IAMグループ/IAMロール（後述）に対して、AWSリソースへのアクセス許可を定義するエンティティ。

JSON形式のアクセスポリシー言語以下の方法でアクセス条件を記述できる。また、以下の方法で作成することができる。

- AWS管理ポリシーをコピーする
- Policy Generatorによる対話形式で作成する
- 独自のポリシーを作成する

### IAMロール

IAMロールは、IAMユーザー/IAMグループ/AWSリソースに割り当てることができるエンティティ。IAMユーザー/IAMグループ/AWSリソースとIAMポリシーとを紐つけることで、それらに対してアクセス権限を設定できる。

たとえばEC2インスタンスに他のAWSリソースへのアクセスが可能になるロールを設定すると、EC2内でAWS CLIコマンドを利用してS3にアクセスしたりLambdaを実行したりできるようになる。

## ハンズオン

### IAMユーザーの作成

- マネジメントコンソールからIAM→ユーザー→ユーザーの新規作成
- アクセスの種類（cliから入るかマネジメントコンソールから入るか）を設定
- ユーザー名を決める
  - 複数ユーザー名を指定することで、同じアクセスの種類とアクセス権限を持ったユーザーを同時に複数作れる
- パスワードを設定
  - ユーザーがログイン時にパスワードをリセットできるように設定できる
- アクセス権限の設定
  - ユーザーをグループに追加するか、既存のユーザーを選んでそれと同様のアクセス権限をアタッチするか、awsが管理するポリシーをアタッチするか、など選べる
- タグの設定
  - key-value型の「タグ」をユーザーに設定できる

### AWSリソースへのポリシーの適用

- EC2インスタンスを作成する
  - AMIを選択する
    - AWSが提供するもの
    - ユーザーコミュニティが提供するもの
    - AWS Marketplaceに掲載されているもの
  - インスタンスタイプを選択する
- S3バケットを作成する
  - バケット名を設定する
    - 小文字英数字、ドット、ハイフンでで構成する
    - ユニークな名前でなくてはいけない
- EC2インスタンスにsshで接続できるように設定する
  - VPCを作成する
  - サブネットを作成する
  - インターネットゲートウェイを作成してVPCにアタッチする
  - VPCにルートテーブルを作成する
  - ルートテーブルにインターネットゲートウェイへのルートを登録する
  - ルートテーブルにサブネットを関連付ける
