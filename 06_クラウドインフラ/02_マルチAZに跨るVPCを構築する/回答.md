# マルチAZに跨るVPCを構築する

## 課題1

### プライベートサブネット

VPC（virtual private cloud）の中のネットワークとしてサブネットを作成する。外部に公開しないサブネットのことをプライベートサブネットと呼ぶ。

VPC、サブネットそれぞれCIDRという表記で使用するIPアドレスの範囲を設定する。

### パブリックサブネット

外部に公開するサブネットのことをパブリックサブネットと呼ぶ。以下の作業が必要になる

- インターネットゲートウェイを作成し、VPCにアタッチする
- ルートテーブルを作成し、パブリックにしたいサブネットと関連付ける
  - ルートテーブルに「ルート」を設定する
  - デフォルトではローカルネットワークに紐付けられているルートのみ設定されている
  - 送信先に`0.0.0.0/0`、ターゲットにインターネットゲートウェイを設定することで、「ローカルネットワークに紐付けられているIPアドレス以外のIPアドレスはすべてインターネットに接続する」という設定にすることができる。

### マルチAZ

サブネットの作成時にAZが選べたので、複数サブネットを作ってそれぞれ違うAZを作成すれば、マルチAZということになるのか…？課題の意図がよくわからなかった。

### パブリックサブネットのEC2 → プライベートサブネットのEC2

EC2インスタンスを作成するときにサブネットを選択する。パブリックサブネットの場合は外部から接続できる。プライベートサブネットは外部から接続できない（同じVPC内の他のサブネットからは接続できる）。

いくつかひっかかった点があったのでメモ。

- VPCとサブネットの設定によっては、EC2インスタンス作成時にパブリックIPが自動で割り当てられないため、EC2インスタンス作成時に詳細設定として設定する必要がある
- パブリックサブネットのec2インスタンスからプライベートサブネットのec2インスタンスに接続するときキーが必要になる
  - 自分のpcから、パブリックサブネットのEC2に、プライベートサブネットのEC2インスタンスのキーを転送する
  - scpコマンドを使う
