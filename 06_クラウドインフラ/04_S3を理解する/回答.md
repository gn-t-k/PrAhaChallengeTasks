# S3を理解する

## 課題1

### ストレージクラス

#### S3 Standard

以下のデータの保存に向いている。

- 頻繁にアクセスされるデータ

#### S3 Standard-IA

以下のデータの保存に向いている。

- 存続期間が長いデータ
- あなり頻繁にアクセスされないデータ

#### S3 Intelligent-Tiering

以下のデータの保存に向いている。

- アクセスパターンが変化する（または不明）データ
- 存続期間が長いデータ

#### S3 One Zone-IA

以下のデータの保存に向いている。

- 存続期間が長いデータ
- あまり頻繁にアクセスされないデータ
- 重要度の低いデータ

#### S3 Glacier

以下のデータの保存に向いている。

- データの取得に数分から数時間かかることが許容されるデータ

#### S3 Glacier Deep Archive

以下のデータの保存に向いている。

- データの取得に12時間かかることが許容されるデータ

#### ストレージクラス診断チャート

![ストレージクラス診断チャート](https://cdn-ssl-devio-img.classmethod.jp/wp-content/uploads/2021/03/Untitled-1-640x321.png)

引用元： <https://dev.classmethod.jp/articles/should_i_choice_s3_storage_class/>

### ライフサイクル

ライフサイクルルールを設定することによって、オブジェクトに対して自動的にアクションを実行できる。

#### アクションの種類

##### 移行アクション

オブジェクトのストレージクラスを移行するアクション。

ストレージクラスの移行元と移行先の組み合わせは以下のように限定されている。

![ストレージクラスの移行元と移行先の組み合わせ](https://cdn-ssl-devio-img.classmethod.jp/wp-content/uploads/2021/03/lifecycle-transitions-v2.png)

引用元：<https://dev.classmethod.jp/articles/3minutes-s3-versioning-lifecycle/>

##### 失効アクション

オブジェクトを有効期限切れにする（削除する）アクション。

#### アクションの指定範囲

ライフサイクルルールは以下の手段で対象をフィルタリングしてスコープを定めて設定することができる。

- プレフィックス（フォルダー）
- オブジェクトタグ

#### 作成から30日後に安いストレージクラスに自動で移動するライフサイクルアクション

コンソール>S3>バケットの管理画面>「管理」>ライフサイクルルールを設定する。

「オブジェクトの最新バージョンをストレージクラス間で移動」を設定する。

#### 作成から90日後に削除する

コンソール>S3>バケットの管理画面>「管理」>ライフサイクルルールを設定する。

「オブジェクトの現行バージョンを有効期限切れにする」を設定する。

## 課題2

### バージョニング

オブジェクトに対してバージョニングを設定することにより、オブジェクトは複数のバージョンを保持できるようになる（デフォルトではバージョニングは無効）。

バージョニングはバケット単位で行われる。

バージョニングが有効にされたオブジェクトは、以下のいずれかのステータスを持つ。

- 無効
- 有効
- 停止

バージョニングが無効のオブジェクトのバージョンは、「現行のバージョン」として扱われる

バージョニングを有効にすると、オブジェクトのバージョンに対してバージョンIDが発行される。

バージョンIDが発行される（「以前のバージョン」のオブジェクトが発生する）ケースは以下の通り。

- 同一キー（名称）のオブジェクトが作成されたとき
- 「現行のバージョン」のオブジェクトが削除されたとき

#### 以前のバージョンの復元

- コピーする … 特定のバージョンと同じ内容を持つオブジェクトが新たにPutされ、「現行のバージョン」になる。コピー後のオブジェクトのバージョンIDは新たに発番される。
- 自信より新しいバージョンを削除する … 特定のバージョンが削除されると、それより古いバージョンが繰り上がって「現行のバージョン」となる。

### レプリケーション

レプリケーションを使用すると、S3バケット間でオブジェクトを自動で非同期的にコピーできる。

レプリケーション設定をレプリケート元バケットに追加してレプリケーションを有効化する。最小設定では、以下を指定する必要がある。

- 送信先バケット
- オブジェクトをレプリケートできるIAMロール
